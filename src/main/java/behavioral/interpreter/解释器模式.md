# 解释器模式

**解释器模式(Interpreter Pattern)**：给定一个语言，定义它的文法的一种表示，并定义一个解释器，这个解释器使用该表示来解释语言中的句子。

解释器模式是一种使用频率相对较低，学习难度相对较大的设计模式。用于描述如何使用面向对象语言构成一个简单的语言解释器。
某些情况下， 为了更好描述某些特定类型的问题，可以创建一种新的语言，这种语言拥有自己的表达式和结构，即文法规则。

对解释器模式的学习可以加深对面向对象思想的理解，并理解编程语言中文法规则的解释过程。

# 文法规则与抽象语法树

解释器模式描述了如何为简单的语言定义一个文法，如何在该语言中表示一个句子，以及如何解释这些句子。

首先要了解如何表示一个语言的文法规则及如何构造一颗抽象语法树。

这里用一个表达式 `1+2+3-4+1` 举例。
该表达式包含了三个语言单位，可以使用以下文法规则来定义：

```
expression ::= value | operation
operation ::= expression '+' expression | expression '-' expression
value ::= an integer
```

以上文法规则包含三条语句，第一条表示表达式的组成方式，其中 `value` 和 `operation` 是后面两个语言单位的定义。
每一条语句所定义的字符串称为语言构造成分或语言单位。符号 `::=` 是“定义为”的意思。语言单位对应终结符表达式和非终结符表达式。
以上文法规则的 operation 是非终结符表达式，它的组成元素仍然是表达式，而 `value` 是终结符表达式，它的组成元素是最基本的语言单位，不能再分解。

文法规则定义中可以使用一些符号表示不同含义，如使用 `|` 表示或，使用 `{`、`}` 表示组合，使用 `*` 表示出现 0 次或多次等。

除了使用文法规则来定义一个语言外，解释器模式还可以通过一种称为抽象语法树（Abstract Syntax Tree, AST）的图形方式直观表示语言的构成。
以下语法树表示表达式 `1+2+3-4+1`。

```
                operation(+)
                |        |
            operation(-)  value(1)
            |         |
        operation(+) value(4)
        |         |
   operation(+) value(3)
    |      |        
 value(1) value(2)
```

# 结构

由于表达式可分为终结符表达式和非终结符表达式，因此解释器模式的结构与组合模式的结构有些类似。

- AbstractExpression 抽象表达式：定义了抽象的解释操作，是所有终结符和非终结符表达式的公共父类。
- TerminalExpression 终结符表达式：是抽象表达式的子类，实现了与文法中的终结符相关联的解释操作。句子中每一个终结符都是该类的一个实例。
  通常一个解释器模式中只有少数几个终结符表达式类，它们的实例可以通过非终结符表达式组成较为复杂的句子。
- NonTerminalExpression 非终结符表达式：是抽象表达式的子类，实现了文法中非终结符的解释操作。由于可以包含终结符和非终结符表达式，所以解释操作一般通过递归方式完成
- Context 环境类：又称为上下文类，用于存储解释器之外的一些全局信息，通常临时存储了需要解释的语句
- 
