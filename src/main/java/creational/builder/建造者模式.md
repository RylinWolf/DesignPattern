# 建造者模式

**建造者模式 Builder Pattern**：将一个复杂对象的构建与它的表示分离，使得同样的构建过程可以创建不同的表示。

是一种对象创建型模式，关注如何一步一步地创建一个复杂对象。

# 结构

- Builder 抽象建造者：为创建一个产品对象的各个部分指定抽象接口，既可以是抽象类，也可以是接口
- ConcreteBuilder 具体建造者：实现了抽象建造者接口
- Product 产品：被构建的复杂对象
- Director 指挥者：又被称为导演类，负责安排复杂对象的建造次序。客户端一般只需要与指挥者进行交互。

## Director 指挥者

一方面隔离了客户端与创建过程，另一方面控制产品对象的创建过程。
指挥类提供了一个建造方法 constructor，该方法中调用了 builder 对象的构造部件的方法，最后返回一个产品对象。

指挥者类是建造者模式的重要组成部分，简单的指挥者类用于指导具体建造者如何构建产品。

### 变化形式

1. 省略：为了简化系统结构，可以将指挥者类与抽象建造者合并，在抽象建造者中提供 construct 静态方法。如果 construct
   方法较复杂，则为了单一职责原则，建议单独封装到指挥者中
2. 钩子方法引入：钩子方法一般返回 bool 型，方法名一般为 isXXX。通过钩子方法可以控制是否调用某个 build 方法。

# 优缺点/适用环境

## 优点

- 客户端不必知道产品内部组成的细节，产品本身与产品构建过程解耦
- 每个具体建造者相对独立，可以方便地替换、增加新的具体建造者。
- 可以更精细地控制产品的创建过程。将复杂产品的创建步骤分解在不同方法中。

## 缺点

- 适用范围有限制：建造者模式创建的产品一般有较多共同点，组成部分相似。如果产品之间差异性很大，如组成部分不相同，则不适合使用。
- 如果产品内部变化复杂，可能导致需要定义很多具体建造者来实现这种变化，导致系统庞大，增加理解难度和运行成本。

## 适用环境

- 需要生成的产品有复杂的内部结构
- 需要生成的产品的属性相互依赖，需要指定其生成顺序
- 对象的创建过程独立于创建该对象的类
- 隔离复杂对象的创建和使用，并使得相同的创建过程可以创建不同的产品

# 本例

开发一款基于角色扮演的多人在线网络游戏，玩家可以扮演一个特定角色，
角色根据不同的游戏情节和统计数据具有不同的能力。

需要对游戏角色进行设计，随着游戏的升级将不断增加新的角色。角色是一个复杂对象，包含性别、脸型等多个组成部分，不同类型的游戏角色都有差异。
无论何种造型的游戏角色，创建步骤都大同小异。
试使用建造者模式来实现游戏角色的创建。

## 分析

- 创建产品类 Actor
- 创建抽象类 AbstractActorBuilder，在其中维护一个 Actor 的属性，并定义建造方法及获得产品的方法 createActor
- 创建具体建造者类，继承抽象建造者，重写建造的方法并配置不同属性
- 创建指挥者类 ActorController，提供根据指定建造者类获得产品的方法 constructor，参数为建造者类的抽象引用
- 使用反射读取 XML 配置的具体建造者类并生成对应对象

