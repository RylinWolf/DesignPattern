# 工厂方法模式

**工厂方法模式 Factory Method Pattern**：定义一个用于创建对象的接口，但是让子类决定将哪一个类实例化。工厂方法模式使得一个类的实例化延迟到子类。

也可简称为工厂模式、虚拟构造器模式（Virtual Constructor Pattern）、多态工厂模式（Polymorphic Factory Pattern）。

不再提供一个统一的工厂类来创建所有的产品对象，
而是针对不同的产品提供不同的工厂。

通过引入抽象的工厂类，使得具有超越简单工厂模式的优越性。

# 结构

工厂方法模式提供一个抽象工厂接口来声明抽象工厂方法，并由子类实现。

通常包含以下四个角色：

1. Product 抽象产品：定义产品的接口，工厂方法模式所创建对象的超类型
2. ConcreteProduct 具体产品：实现抽象产品接口，和具体工厂一一对应
3. Factory 抽象工厂：声明工厂方法，用于返回一个产品。是工厂方法模式的核心。
4. ConcreteFactory 具体工厂：是抽象工厂类的子类，返回一个具体产品的实例

# 优缺点

## 优点

- 工厂方法用来创建产品，并向客户隐藏了那种具体产品类将被实例化这一细节。客户只需关心具体实现的工厂。
- 基于工厂角色和产品角色的多态性设计是工厂方法模式的关键。能让工厂自主决定创建哪种产品对象。
- 加入新产品时无需修改抽象工厂，只需要添加具体工厂和具体产品。

## 缺点

- 系统中类的个数成对增加，增加复杂度
- 引入抽象层，在客户端代码中均适用抽象层进行定义，增加理解难度

# 适用环境

1. 客户端不知道它所需要的对象的类。可将具体工厂的类名存储在配置文件或数据库中。
2. 抽象工厂类通过其子类来指定创建哪个对象。

# 本例

系统运行日志记录器可以通过多种途径保存系统日志，包括文件、数据库等。用户可以灵活地更换日志记录器。
设计各类日志记录器时，开发人员发现需要进行一些初始化工作，而某些参数的设置有严格的先后次序。
为了更好地封装记录器的初始化过程并保证多种记录器切换的灵活性，现使用工厂方法模式设计该系统。

## 分析

- 创建抽象工厂接口、产品接口
- 创建工厂的实现类、产品实现类，工厂实现类提供获得具体产品的方法
- 通过反射机制，从 XML 配置文件中获取工厂类的类路径并生成其实例，通过实例获取产品。
- 工厂模式方法中，工厂方法可以重载以实现根据不同参数获取不同对象
- 工厂方法也可隐藏：将抽象工厂接口转为抽象类，提供方法，在该方法内部获取产品并调用产品的业务方法

